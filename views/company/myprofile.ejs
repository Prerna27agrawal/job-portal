<%- include("../partials/header") %>
<style>
    *{
        box-sizing: border-box;
    }
    .post-editor,
    .stream-post {
        padding: .75rem;
        background: #f7f7f9;
        border: 1px solid #eceeef;
        border-radius: .25rem;
        margin-bottom: 1.5rem
    }

    .profile-wrapper {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column
    }

    @media (min-width:768px) {
        .profile-wrapper {
            -webkit-box-orient: horizontal;
            -webkit-box-direction: normal;
            -ms-flex-direction: row;
            flex-direction: row
        }
    }

    body.menubar-top .profile-wrapper {
        border: 1px solid #eceeef
    }

    .profile-section-user {
        border-right: 1px solid #eceeef;
        -webkit-box-flex: 0;
        -ms-flex: 0 0 100%;
        flex: 0 0 100%;
    }

    @media (min-width:768px) {
        .profile-section-user {
            -ms-flex-preferred-size: 34%;
            flex-basis: 34%;
        }
    }

    @media (min-width:992px) {
        .profile-section-user {
            -ms-flex-preferred-size: 30%;
            flex-basis: 20%;
        }
    }

    .profile-section-user table {
        margin-bottom: 0
    }

    .profile-section-user table td {
        border: none;
        padding-left: 0;
        padding-right: 0
    }

    .profile-section-user .img-gallery [class*=col] {
        padding-right: .25rem;
        padding-left: .25rem
    }

    .profile-section-user .img-gallery .row {
        margin-right: -.25rem;
        margin-left: -.25rem
    }

    .profile-section-user .img-gallery .g__item {
        margin-bottom: .5rem
    }

    .profile-cover-img img {
        width: 100%;
        height: auto
    }

    .profile-info-brief {
        position: relative;
        padding-top: 74px !important
    }

    .profile-info-brief .user-profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 100%;
        position: absolute;
        top: -50px;
        left: calc(50% - 50px)
    }

    .profile-section-main {
        -webkit-box-flex: 0;
        -ms-flex: 0 1 5000px;
        flex: 0 1 5000px;
        overflow: hidden
    }

    .profile-tabs {
        padding: .75rem 1.5rem 0;
        background: #f7f7f9;
        border-top: 1px solid #eceeef
    }

    .profile-tabs .nav-link {
        font-weight: 400;
        padding: .75rem 1.5rem
    }

    .profile-tabs .nav-link.active,
    .profile-tabs .nav-link.active:focus,
    .profile-tabs .nav-link.active:hover,
    .profile-tabs .nav-link:active,
    .profile-tabs .nav-link:focus {
        color: #60c84c
    }

    .profile-tabs-content .tab-pane {
        padding: 1.5rem
    }

    .post-editor .post-field {
        width: 100%;
        height: 120px;
        resize: vertical;
        border-radius: .25rem;
        margin-bottom: .5rem;
        padding: .5rem;
        border-color: #eceeef
    }

    .post-editor .post-field:focus {
        box-shadow: none;
        outline: none
    }
   
    .stream-post {
        position: relative
    }

    .sp-author {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex
    }

    .sp-author .sp-author-avatar {
        display: inline-block;
        height: 64px;
        width: 64px;
        margin-right: 16px
    }

    .sp-author .sp-author-avatar img {
        width: 100%;
        height: 100%;
        border-radius: 50%
    }

    .sp-author .sp-author-name {
        font-size: 1rem;
        margin: .5rem 0
    }

    @media (min-width:992px) {
        .sp-author {
            position: absolute;
            width: 100%;
            left: 1rem;
            top: 1rem
        }

        .sp-author .sp-author-name {
            margin: 0;
            position: absolute;
            left: 80px;
            top: 8px;
            background: rgba(0, 0, 0, .9);
            padding: .75rem 1.5rem;
            border-radius: 6px;
            z-index: -1;
            opacity: 0;
            -webkit-transform: rotate(90deg);
            -ms-transform: rotate(90deg);
            transform: rotate(90deg);
            -webkit-transform-origin: left center;
            -ms-transform-origin: left center;
            transform-origin: left center;
            -webkit-transition: opacity .3s, -webkit-transform .3s;
            transition: opacity .3s, -webkit-transform .3s;
            transition: opacity .3s, transform .3s;
            transition: opacity .3s, transform .3s, -webkit-transform .3s
        }

        .sp-author .sp-author-name>a {
            color: #fff
        }

        .sp-author .sp-author-avatar:hover+.sp-author-name {
            opacity: 1;
            z-index: 9999;
            -webkit-transform: rotate(0);
            -ms-transform: rotate(0);
            transform: rotate(0)
        }

        .sp-author .sp-author-name:after {
            content: "";
            display: block;
            position: absolute;
            left: -8px;
            top: 50%;
            -webkit-transform: translateY(-50%);
            -ms-transform: translateY(-50%);
            transform: translateY(-50%);
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-right: 8px solid rgba(0, 0, 0, .9)
        }
    }

    .sp-content {
        position: relative;
        border-radius: .25rem;
        background: #fff;
        padding: 1rem;
        margin-top: 1rem
    }

    .sp-content .sp-info {
        font-size: .999rem;
        color: #636c72;
        position: absolute;
        top: -3rem;
        left: 80px
    }

    .sp-content .sp-paragraph {
        font-size: 1.2rem;
        line-height: 1.6;
        margin-bottom: 1rem
    }

    .sp-content .sp-paragraph:last-child {
        margin-bottom: 0
    }

    .sp-content .sp-gallery img {
        margin-right: .5rem;
        margin-bottom: .5rem;
        max-width: 220px;
        max-height: 130px
    }

    .sp-content .sp-video {
        width: 100%;
        height: auto
    }

    @media (min-width:992px) {
        .sp-content {
            margin-left: 80px;
            margin-top: 0
        }

        .sp-content .sp-info {
            position: static;
            font-style: italic;
            margin-bottom: 1rem
        }
    }

    #profile-settings textarea {
        padding: 1rem;
        line-height: 1.8;
        height: 140px;
        font-style: italic
    }

    #profile-settings label {
        font-size: 1rem
    }

    #profile-settings .form-control {
        color: #818a91
    }

    #profile-settings .form-control,
    #profile-settings .form-control:focus {
        box-shadow: none;
        outline: none
    }

    .edit-cover {
        position: relative;
        padding: .5rem;
        border-radius: .25rem;
        border: 1px solid #eceeef;
        background: #f7f7f9;
        height: 400px
    }

    .edit-cover img {
        border-radius: .25rem;
        width: 100%;
        height: 100%
    }

    .edit-cover .btn {
        position: absolute;
        right: 32px;
        bottom: 32px
    }

    .postBtn {
        display: none;
    }
    /* #gallery-image{
        display:flex;
  justify-content:space-between;
    } */
    #image-editor{
        width: 50%;
        transition: width 2s, height 4s;
        transition-timing-function: ease-in-out;
    
    }
    #image-editor:hover {
       width: 80%;

    }
    #gallery{
  -webkit-column-count:3;
  -moz-column-count:3;
  column-count:3;
  
  -webkit-column-gap:20px;
  -moz-column-gap:20px;
  column-gap:20px;
  padding: 10px 0 10px 10px;
}

@media (max-width:1200px){
  #gallery{
  -webkit-column-count:2;
  -moz-column-count:2;
  column-count:2;
    
  -webkit-column-gap:20px;
  -moz-column-gap:20px;
  column-gap:20px;
  padding: 10px 0 10px 10px;
}
}
@media (max-width:1000px){
  #gallery{
  -webkit-column-count:1;
  -moz-column-count:1;
  column-count:1;
  padding: 10px 0 10px 10px;
}  
}
.card{
  width:100%;
  margin:0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
}
.modal-img{
  width:100%;
  height:100%;
}
.modal-body{
  padding:0px;
}

element.style {
    padding-right: 17px;
    display: block;
}
.modal-open .modal {
    overflow-x: hidden;
    overflow-y: auto;
}

.show {
    display: block!important;
}

.modal-backdrop.fade {
    opacity: 0.5;
}
.modal-body{
    opacity: 1 !important;
}
.closebtn {
  position: absolute;
  top: 10px;
  right: 15px;
  color: white;
  font-size: 35px;
  cursor: pointer;
}
.none{
    position: relative;
    overflow-y: scroll;
    height: auto;
    box-shadow:-3px 5px 15px #000;
   
}
.none::-webkit-scrollbar {
    display: none;
}

.overlay {
  position: absolute;
  top: 0;
  background: rgb(0, 0, 0);
  background: rgba(0, 0, 0, 0.5); /* Black see-through */
  color: #f1f1f1;
  width: 100%;
  transition: .5s ease;
  opacity: 0;
  color: white;
  font-size: 20px;
  padding: 20px;
  text-align: center;
}

/* When you mouse over the container, fade in the overlay title */
.none:hover .overlay {
  opacity: 1;
}
/* ::-webkit-scrollbar {
    width: 5px;
} */
.sticky{
    position: -webkit-sticky;
  position: sticky;
  top: 0;
}
</style>
<div class="container">
<div class="container">
    <% company.forEach(function(company){%>
    <div class="profile-wrapper">
        <div class="profile-section-user">
            <div class="profile-cover-img"><img
                    src="https://www.whiteheadassoc.com/wp-content/uploads/2018/09/iStock-998993038-768x384.jpg" alt="">
            </div>
            <div class="profile-info-brief p-3"><img class="img-fluid user-profile-avatar" src="<%=company.logo%>"
                    alt="">
                <div class="text-center">
                    <h5 class="text-uppercase mb-4"><b><%= company.name%></b></h5>
                    <p class=" fz-base" style="color:rgba(52, 10, 58, 0.678)"><i><%= company.tagline%></i></p>
                    <hr>
                    <p class="text-muted fz-base">Established in <%= company.establishmentDate%></p>
                </div>
            </div>
            <!-- /.profile-info-brief -->
            <hr class="m-0">
            <div class="hidden-sm-down">
                <hr class="m-0">
                <div class="profile-info-general p-4">
                    <h6 class="mb-3">General Description</h6>
                    <p class="text-muted"><%=company.description%></p>
                </div>
                <!-- /.profile-info-general -->
                <hr class="m-0">
                <!-- /.profile-info-contact -->
                <div class="profile-info-contact p-4">
                    <h6 class="mb-3">Contact Information</h6>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td><strong>URL:</strong></td>
                                <td>
                                    <p class="text-muted mb-0"><%=company.company_url%></p>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>LinkedIn:</strong></td>
                                <td>
                                    <p class="text-muted mb-0"><%=company.linkedinId%></p>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Contact at:</strong></td>
                                <td>
                                    <p class="text-muted mb-0"><%=company.contactno%></p>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Facebook:</strong></td>
                                <td>
                                    <p class="text-muted mb-0"><%=company.facebookId%></p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <hr class="m-0">
            </div>
            <!-- /.hidden-sm-down -->
        </div>
        <!-- /.profile-section-user -->
        <div class="profile-section-main">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs profile-tabs sticky" role="tablist">
                <li class="nav-item" id="timeline"><a class="nav-link active" data-toggle="tab" href="#profile-overview"
                        role="tab" onclick="openCity( event , 'profile-overview' )" id="defaultOpen" >Timeline</a></li>
                <% if((currentUser && company.createdBy.id.equals(currentUser._id) && currentUser.isCompany)){ %>
                <li class="nav-item" id="imeline"><a class="nav-link active" href="/company/<%= company._id %>/editprofile">Edit Profile</a></li>
                <% } %>
                <li class="nav-item" id="timeline"><a class="nav-link active" data-toggle="tab" href="#photo-overview"
                    role="tab" onclick="openCity( event , 'photo-overview' )">Photos</a></li>
            </ul>
            <!-- /.nav-tabs -->
            <!-- Tab panes -->
            <div class="tab-content profile-tabs-content">
                <div class="tab-pane active" id="profile-overview" role="tabpanel">
                        <% if((currentUser && company.createdBy.id.equals(currentUser._id)) && currentUser.isCompany){ %>
                        <div class="post-editor " id="post-editor">
                            <form action="/company/<%= company._id %>/posts" method="POST">
                            <input style="width: 100%; border:2mm; margin-bottom:5px" name="posts[heading]" placeholder="Post Heading"/>
                            <textarea name="posts[description]" id="post-field" class="post-field"
                                placeholder="Write Something Cool!"></textarea>

                            <button class="btn btn-success px-4 py-1" href="#">Post</button>
                       
                        </form>
                    </div>
                        <% }%>
                 

                    <!-- /.post-editor -->
                    <div class="stream-posts">
                        <%  company.posts.forEach(function(post){%>
                        <div class="stream-post">
                            <div class="sp-author">
                                <a href="#" class="sp-author-avatar"><img src="<%=company.logo%>" alt=""></a>
                                <h6 class="sp-author-name"><a href="#"><%= post.heading %></a></h6>
                            </div>
                            <div class="sp-content">
                                <div class="sp-info"><%= moment(post.createdAt).fromNow() %></div>
                                <p class="sp-paragraph mb-0"><%= post.description %></p>
                            </div>
                            <!-- /.sp-content -->
                            <% if((currentUser && company.createdBy.id.equals(currentUser._id) && currentUser.isCompany)){ %>
                            <div class="btn-toolbar" style="padding-left: 15px">
                                <form onsubmit="return confirm('Do you really want to Delete the following?');"  class="delete-form"
                                    action="/company/<%= company._id%>/postsdelete/<%= post._id %>?_method=DELETE"
                                    method="POST">
                                    <button class="btn btn-xs btn-danger pull-right" type="Submit" value="Delete"><span class="glyphicon glyphicon-trash"></span></button>
                                </form>
                                <a class="btn btn-xs btn-info  active active pull-right" style="margin-right: 3px;"
                                    href="/company/<%= company._id%>/posts/<%= post._id %>/edit">
                                    <span class="glyphicon glyphicon-edit"></span></a>
                            </div>
                            <% } %>
                        </div>
                        <% }) %>
                    </div>
                    <!-- /.stream-posts -->
                </div>
            </div>
            <div class="tab-content profile-tabs-content">
                <div class="tab-pane active" id="photo-overview" role="tabpanel">
                    <!-- image.form start-->
                    <% if((currentUser && company.createdBy.id.equals(currentUser._id)) && currentUser.isCompany){ %>
                    <p style="text-align: right;">
                    <button class="btn btn-success" id="gallery-image" onclick="ShowAndHide()" onmouseover="Show()"> ADD IMAGE <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-plus" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                      </svg></button>
                      </p>
                      
                     <div class="post-editor " id="image-editor" style="display: none;">
                        
                        <form action="/company/<%= company._id %>/images" method="POST" enctype="multipart/form-data">
                            <input style="width: 90%; border:2mm; padding:5px; margin:10px 10px 0" name="caption" placeholder="Add caption(if any)"/>
                            <!-- <textarea name="posts[description]" id="post-field" class="post-field"
                                placeholder="Write Something Cool!"></textarea> -->
                            <input type="file" name="image"  accept="image/*" style="margin:10px 10px 0px" required>
                            <button class="btn btn-success px-4 py-1" style="margin:10px" href="#">Add </button>
                       
                        </form>
                      
                    </div> 
                    <% }%> 
                    <!--image.form end--> 
                    <hr>
                    <div id="gallery" class="container-fluid">  
                        <% company.photos.forEach(function(each){ %>
                            <div class="none" style=" margin: 6% auto;">
                            <img src="<%= each.image %>" class="card img-responsive" alt="<%= each.caption %>">
                            <div class="overlay" style="padding: 10px;font-size: 15px;bottom: 0;top: auto;">uploaded <%= moment(each.createdAt).fromNow() %></div>
                            </div>
                        <% }); %>
                      
                      </div>
                      <div id="myModal" class="modal fade in" role="dialog">
                        <span class="closebtn">&times;</span>
                        <div class="modal-dialog">
                         
                          <!-- Modal content-->
                          <div class="modal-content">
                            <div class="modal-body">
                            </div>
                          </div>
                      
                        </div>
                      </div>
                  </div>  
            </div>
            <!-- /.tab-content -->
        </div>
        <!-- /.profile-section-main -->
    </div>
    <% }) %>
</div>


</div>
<script>
    
    $(document).ready(function(){
    

      $("img").click(function(){
      var t = $(this).attr("src");
      var y = $(this).attr("alt");
      $(".modal-body").html("<div class='none'><img src='"+t+"' class='modal-img'><div class='overlay'>"+y+"</div></div>");
      $("#myModal").modal();
    });
});

$(document).ready(function(){
    

    $(".closebtn").click(function(){
        $('#myModal').modal('hide')
  });
});
</script>
<script>
    function openCity(evt, status) {
            var i, tabcontent, navitem;
            tabcontent = document.getElementsByClassName("tab-pane");
            console.log(0);
            for (i = 0; i < tabcontent.length; i++) {
               tabcontent[i].style.display = "none";
            }
            navitem = document.getElementsByClassName("nav-link");
            for (i = 0; i < navitem.length; i++) {
                navitem[i].className = navitem[i].className.replace(" active", "");
            }
            document.getElementById(status).style.display = "block";
            evt.currentTarget.className += " active";
        }
        document.getElementById("defaultOpen").click();

    function ShowAndHide() {
    var x = document.getElementById('image-editor');
    if (x.style.display == 'none') {
        x.style.display = 'block';
    } else {
        x.style.display = 'none';
    }
}
    function Show() {
    var x = document.getElementById('image-editor');
    if (x.style.display == 'none') {
        x.style.display = 'block';
    }
}

</script>
<!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>